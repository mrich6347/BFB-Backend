{
  "name": "Timezone-Aware Month Rollover Test",
  "description": "Comprehensive test of month rollover functionality with timezone awareness. Tests that assigned amounts reset to 0, activity resets to 0, and available balances (positive, negative, zero) carry forward correctly across month boundaries.",
  "steps": [
    {
      "action": "create_budget",
      "description": "Create test budget for month rollover testing",
      "params": {
        "name": "Month Rollover Test Budget",
        "currency": "USD",
        "currency_placement": "BEFORE",
        "date_format": "US_SLASH",
        "number_format": "DOT_COMMA"
      }
    },
    {
      "action": "create_account",
      "description": "Create checking account with $3000 to support all test scenarios",
      "params": {
        "name": "Checking",
        "account_type": "CASH",
        "account_balance": 3000
      }
    },
    {
      "action": "create_category_group",
      "description": "Create Monthly Expenses category group",
      "params": {
        "name": "Monthly Expenses"
      }
    },
    {
      "action": "create_category",
      "description": "Create Groceries category (will have positive available balance)",
      "params": {
        "name": "Groceries",
        "category_group_name": "Monthly Expenses"
      }
    },
    {
      "action": "create_category",
      "description": "Create Rent category (will have zero available balance)",
      "params": {
        "name": "Rent",
        "category_group_name": "Monthly Expenses"
      }
    },
    {
      "action": "create_category",
      "description": "Create Utilities category (will have negative available balance)",
      "params": {
        "name": "Utilities",
        "category_group_name": "Monthly Expenses"
      }
    },
    {
      "action": "create_category_group",
      "description": "Create Savings category group",
      "params": {
        "name": "Savings"
      }
    },
    {
      "action": "create_category",
      "description": "Create Emergency Fund category (will have positive available balance)",
      "params": {
        "name": "Emergency Fund",
        "category_group_name": "Savings"
      }
    },
    {
      "action": "create_category",
      "description": "Create Vacation category (will have negative available balance from overspending)",
      "params": {
        "name": "Vacation",
        "category_group_name": "Savings"
      }
    },
    {
      "action": "get_state",
      "description": "Verify initial state: Ready to Assign = 3000, all categories have 0 balances"
    },
    {
      "action": "assign_money",
      "description": "Assign $200 to Groceries",
      "params": {
        "category_name": "Groceries",
        "amount": 200
      }
    },
    {
      "action": "assign_money",
      "description": "Assign $1000 to Rent",
      "params": {
        "category_name": "Rent",
        "amount": 1000
      }
    },
    {
      "action": "assign_money",
      "description": "Assign $100 to Utilities",
      "params": {
        "category_name": "Utilities",
        "amount": 100
      }
    },
    {
      "action": "assign_money",
      "description": "Assign $300 to Emergency Fund",
      "params": {
        "category_name": "Emergency Fund",
        "amount": 300
      }
    },
    {
      "action": "assign_money",
      "description": "Assign $200 to Vacation",
      "params": {
        "category_name": "Vacation",
        "amount": 200
      }
    },
    {
      "action": "get_state",
      "description": "Verify after assignments: Ready to Assign = 1200, all categories have assigned amounts"
    },
    {
      "action": "create_transaction",
      "description": "Spend $150 on groceries (leaving $50 available)",
      "params": {
        "account_name": "Checking",
        "payee": "Grocery Store",
        "category_name": "Groceries",
        "amount": -150,
        "date": "2025-06-15"
      }
    },
    {
      "action": "create_transaction",
      "description": "Pay $1000 rent (exactly matching assigned amount)",
      "params": {
        "account_name": "Checking",
        "payee": "Landlord",
        "category_name": "Rent",
        "amount": -1000,
        "date": "2025-06-15"
      }
    },
    {
      "action": "create_transaction",
      "description": "Pay $150 utilities (overspending by $50)",
      "params": {
        "account_name": "Checking",
        "payee": "Electric Company",
        "category_name": "Utilities",
        "amount": -150,
        "date": "2025-06-15"
      }
    },

    {
      "action": "create_transaction",
      "description": "Spend $250 on vacation (overspending by $50)",
      "params": {
        "account_name": "Checking",
        "payee": "Travel Agency",
        "category_name": "Vacation",
        "amount": -250,
        "date": "2025-06-15"
      }
    },
    {
      "action": "get_state",
      "description": "Verify current month state before rollover simulation"
    }
  ],
  "expectedFinalState": {
    "readyToAssign": 1200,
    "accounts": {
      "Checking": {
        "working_balance": 1450
      }
    },
    "categories": {
      "Groceries": {
        "assigned": 200,
        "activity": -150,
        "available": 50
      },
      "Rent": {
        "assigned": 1000,
        "activity": -1000,
        "available": 0
      },
      "Utilities": {
        "assigned": 100,
        "activity": -150,
        "available": -50
      },
      "Emergency Fund": {
        "assigned": 300,
        "activity": 0,
        "available": 300
      },
      "Vacation": {
        "assigned": 200,
        "activity": -250,
        "available": -50
      }
    }
  },
  "ynabBehaviorNotes": [
    "This test verifies the core month rollover logic that happens automatically in YNAB:",
    "1. ASSIGNED AMOUNTS: All assigned amounts should reset to $0 in the new month",
    "2. ACTIVITY: All activity should reset to $0 in the new month", 
    "3. AVAILABLE BALANCES: Should carry forward exactly as they were:",
    "   - Groceries: +$50 (positive balance carries forward)",
    "   - Rent: $0 (zero balance stays zero)",
    "   - Utilities: -$50 (negative balance carries forward)",
    "   - Emergency Fund: +$300 (positive balance carries forward)",
    "   - Vacation: -$50 (negative balance from overspending carries forward)",
    "4. READY TO ASSIGN: Should remain $1200 (Total Available $3000 - Total Assigned $1800). Overspending does NOT reduce Ready to Assign in YNAB.",
    "5. TIMEZONE AWARENESS: Month rollover should respect user's timezone context",
    "6. The rollover logic is triggered automatically when requesting data for a new month",
    "7. This test creates various balance scenarios to ensure all edge cases work correctly"
  ]
}
